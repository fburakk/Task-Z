<div class="kanban-board">
    <!-- Board Header -->

    <div class="board-header d-flex justify-content-between align-items-center">
  <h1>{{ board?.name }}</h1>
  <div class="d-flex gap-2">
    <button class="btn btn-primary" (click)="addUserModal()">Yeni Kullanıcı Ekle</button>
    <button class="btn btn-primary" (click)="openStatusModal()">Yeni Liste Ekle</button>
  </div>
</div>

    

    <!-- Kanban Columns -->
    <div class="board-columns">
        <div class="status-column" *ngFor="let status of statuses">
            <div class="column-header">
                <h3>{{ status.title }}</h3>
                <span class="task-count">{{ (tasksByStatus[status.id] || []).length }}</span>
            </div>
            <div class="task-list" 
                 (dragover)="onDragOver($event, status.id)"
                 (drop)="onDrop($event, status.id)">
                <div class="task-card" 
                     *ngFor="let task of (tasksByStatus[status.id] || [])"
                     draggable="true"
                     (dragstart)="onDragStart(task)"
                     (click)="startEditingTask(task)">
                    <div class="task-header">
                        <div class="priority-selector" (click)="$event.stopPropagation()">
                            <span class="priority-badge" [ngClass]="getPriorityClass(task.priority)"
                                  (click)="$event.stopPropagation()">
                            {{ task.priority }}
                        </span>
                            <div class="priority-dropdown">
                                <button class="priority-option" [ngClass]="getPriorityClass('high')"
                                        (click)="updateTaskPriority(task.id, 'high')">High</button>
                                <button class="priority-option" [ngClass]="getPriorityClass('medium')"
                                        (click)="updateTaskPriority(task.id, 'medium')">Medium</button>
                                <button class="priority-option" [ngClass]="getPriorityClass('low')"
                                        (click)="updateTaskPriority(task.id, 'low')">Low</button>
                            </div>
                        </div>
                        <span class="task-id">#{{ task.id }}</span>
                    </div>
                    <h4 class="task-title">{{ task.title }}</h4>
                    <p class="task-description">{{ task.description }}</p>
                    <div class="task-footer">
                        <div class="assignee" *ngIf="task.assigneeUsername">
                            <span class="assignee-label">Assigned to:</span>
                            <span class="assignee-name">{{ task.assigneeUsername }}</span>
                        </div>
                        <div class="due-date" *ngIf="task.dueDate">
                            <span class="due-date-label">Due:</span>
                            <span class="due-date-value">{{ task.dueDate | date:'shortDate' }}</span>
                        </div>
                    </div>
                </div>
                <div class="add-task-placeholder" (click)="openTaskModal(status.id)">
                    + Add a task
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Modal -->
<div *ngIf="isStatusModalOpen" class="modal">
    <div class="modal-background" (click)="closeStatusModal()"></div>
    <div class="modal-content">
        <div class="modal-box">
            <button class="close-button" (click)="closeStatusModal()">×</button>
            <h3 class="modal-title">Yeni Liste Ekle</h3>
            
            <input
                class="modal-input"
                [(ngModel)]="newStatusName"
                type="text"
                placeholder="Liste adını girin"
                name="statusName"
                required
            />

            <div class="modal-buttons">
                <button class="modal-button create" (click)="createStatus()">Oluştur</button>
                <button class="modal-button cancel" (click)="closeStatusModal()">İptal</button>
            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
  
      <div *ngIf="showAddUserModal" class="modal">
        <div class="modal-background" (click)="closeAddUserModal()"></div>
        <div class="modal-content">
          <div class="modal-box">
            <button class="close-button" (click)="closeAddUserModal()">×</button>
            <h3 class="modal-title">Yeni Kullanıcı Ekle</h3>
            
            <input
              class="modal-input"
              [(ngModel)]="newUsersName"
              type="text"
              placeholder="Kullanıcı adını girin."
            />

              <input
              class="modal-input"
              [(ngModel)]="newUsersRole"
              type="text"
              placeholder="Kullanıcı rolünü girin."
            />
      
            <div class="modal-buttons">
              <button class="modal-button create" (click)="addNewUser()">Oluştur</button>
              <button class="modal-button cancel" (click)="closeAddUserModal()">İptal</button>
            </div>
          </div>
        </div>
      </div>

<!-- Task Modal -->
<div *ngIf="isModalOpen" class="modal">
    <div class="modal-background" (click)="closeTaskModal()"></div>
    <div class="modal-content">
        <div class="modal-box">
            <button class="close-button" (click)="closeTaskModal()">×</button>
            <h3 class="modal-title">Yeni Görev Ekle</h3>
            
            <input
                class="modal-input"
                [(ngModel)]="newTaskTitle"
                type="text"
                placeholder="Görev başlığı"
                name="taskTitle"
                required
            />

            <textarea
                class="modal-input"
                [(ngModel)]="newTaskDescription"
                placeholder="Görev açıklaması"
                name="taskDescription"
                required
            ></textarea>

            <select
                class="modal-input"
                [(ngModel)]="newTaskPriority"
                name="taskPriority"
                required
            >
                <option value="low">Düşük Öncelik</option>
                <option value="medium">Orta Öncelik</option>
                <option value="high">Yüksek Öncelik</option>
            </select>

            <input
                class="modal-input"
                [(ngModel)]="newTaskDueDate"
                type="date"
                placeholder="Son tarih"
                name="taskDueDate"
            />

            <select
                class="modal-input"
                [(ngModel)]="newTaskUsername"
                name="taskUsername"
            >
                <option value="">Görev atanacak kişiyi seçin</option>
                <option *ngFor="let user of boardUsers" [value]="user.username">
                    {{ user.username }}
                </option>
            </select>

            <div class="modal-buttons">
                <button class="modal-button create" (click)="createTask()">Oluştur</button>
                <button class="modal-button cancel" (click)="closeTaskModal()">İptal</button>
            </div>
        </div>
    </div>
</div>

<!-- Task Detail Modal -->
<div *ngIf="isTaskDetailModalOpen && editingTask" class="modal">
    <div class="modal-background" (click)="closeTaskDetailModal()"></div>
    <div class="modal-content">
        <div class="modal-box task-detail-modal">
            <button class="close-button" (click)="closeTaskDetailModal()">×</button>
            
            <div class="task-detail-header">
                <input class="task-title-input" [(ngModel)]="editingTask.title" type="text" placeholder="Task title">
                <span class="task-id">#{{ editingTask.id }}</span>
            </div>

            <div class="task-detail-section">
                <h3>Description</h3>
                <textarea class="task-description-input" [(ngModel)]="editingTask.description" 
                    placeholder="Add a description..."></textarea>
            </div>

            <div class="task-detail-section">
                <h3>Details</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Priority:</span>
                        <select class="priority-select" [(ngModel)]="editingTask.priority">
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Due Date:</span>
                        <input type="date" class="date-input" [(ngModel)]="editingTask.dueDate">
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Assigned To:</span>
                        <select class="assignee-select" [(ngModel)]="editingTask.assigneeUsername">
                            <option value="">Unassigned</option>
                            <option *ngFor="let user of boardUsers" [value]="user.username">
                                {{ user.username }}
                            </option>
                        </select>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Current Status:</span>
                        <span class="detail-value status-badge">{{ getStatusTitle(editingTask.statusId) }}</span>
                    </div>
                </div>
            </div>

            <div class="task-detail-section">
                <h3>Activity</h3>
                <div class="detail-grid">
                    <div class="detail-item">
                        <span class="detail-label">Created By:</span>
                        <span class="detail-value">{{ editingTask.createdByUsername }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Created:</span>
                        <span class="detail-value">{{ formatDate(editingTask.created) }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Last Modified By:</span>
                        <span class="detail-value">{{ editingTask.lastModifiedByUsername }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Last Modified:</span>
                        <span class="detail-value">{{ formatDate(editingTask.lastModified) }}</span>
                    </div>
                </div>
            </div>

            <div class="task-detail-actions">
                <button class="btn btn-primary" (click)="updateTask()">Save Changes</button>
                <button class="btn btn-danger" (click)="deleteTask(editingTask.id, editingTask.statusId)">Delete Task</button>
            </div>
        </div>
    </div>
</div>
